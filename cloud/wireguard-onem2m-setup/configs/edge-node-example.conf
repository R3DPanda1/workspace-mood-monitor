# WireGuard Edge Node Configuration (MN-CSE on Raspberry Pi)
# Location: /etc/wireguard/wg0.conf

[Interface]
# Edge node VPN IP (increment for each node: .2, .3, .4, etc.)
Address = 10.100.0.2/32

# Generate with: wg genkey
PrivateKey = YOUR_EDGE_PRIVATE_KEY

# Optional DNS
DNS = 1.1.1.1

# Enable forwarding and NAT for local devices
# Replace wlan0 with your interface (eth0 for Ethernet)
# Replace 192.168.1.0/24 with your actual LAN subnet
PostUp   = sysctl -w net.ipv4.ip_forward=1
PostUp   = iptables -A FORWARD -i wg0 -o wlan0 -j ACCEPT
PostUp   = iptables -A FORWARD -i wlan0 -o wg0 -j ACCEPT
PostUp   = iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o wg0 -j MASQUERADE
PostDown = sysctl -w net.ipv4.ip_forward=0
PostDown = iptables -D FORWARD -i wg0 -o wlan0 -j ACCEPT
PostDown = iptables -D FORWARD -i wlan0 -o wg0 -j ACCEPT
PostDown = iptables -t nat -D POSTROUTING -s 192.168.1.0/24 -o wg0 -j MASQUERADE

[Peer]
# Cloud hub public key (get from cloud administrator)
PublicKey = CLOUD_HUB_PUBLIC_KEY

# Cloud server public IP and port
Endpoint = YOUR_CLOUD_SERVER_IP:51820

# Route VPN subnet through the tunnel
AllowedIPs = 10.100.0.0/24

# Keep connection alive through NAT
PersistentKeepalive = 25
